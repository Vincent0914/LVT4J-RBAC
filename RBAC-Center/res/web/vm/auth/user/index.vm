#set($navs=['用户授权'])
#set($pageDesc='所有使用授权中心的用户在当前产品下权限的配置')
#parse('/header.vm')

<script src="/vm/auth/user/index.js"></script>

##用户授权配置
<div id="editUserAuthDiv" class="col-xs-12" style="display:none;"><div class="widget-box">
<div class="widget-header">
    <h4 class="widget-title" style="word-break:break-all;">为用户授权</h4>
    <div class="widget-toolbar">
        <a href="javascript:;" onclick="$(this).closest('.col-xs-12').slideUp()">
            <i class="ace-icon fa fa-close bigger-130"></i>
        </a>
    </div>
</div>
<div class="widget-body"><div class="widget-main">
<form class="form-horizontal">
    <p class="valid-err text-danger col-xs-9 col-xs-offset-3"></p>
    <div class="form-group">
        <label class="col-xs-3 control-label">用户ID：</label>
        <div class="col-xs-9 msg-tooltiper">
            <input id="userAutoId" name="userAutoId" type="hidden"/>
            <input id="userId" name="id" type="text" class="form-control" readonly="readonly"/>
            <div class="tooltip-msg">
                <strong>ID:</strong><span id="userName"></span><br>
                <p id="userDes"></p>
            </div>
        </div>
    </div>
    <div class="form-group">
        <div class="col-xs-9 col-xs-offset-3">
            <div class="widget-box collapsed">
                <div class="widget-header">
                    <h4 class="widget-title">属性配置</h4>
                    <span class="widget-toolbar">
                        <a href="#" data-action="collapse">
                            <i class="ace-icon fa fa-chevron-down"></i>
                        </a>
                    </span>
                </div>
                <div class="widget-body" style="display: none;">
                    <div id="params" name="params" data-type="obj" class="widget-main"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="form-group">
        <label class="col-xs-3 control-label">角色分配：</label>
        <div class="col-xs-9">
            <div id="roles" auth-model="role" name="roleAutoIds" data-type="arr" widget="auth-chooser"></div>
        </div>
    </div>
    <div class="form-group">
        <label class="col-xs-3 control-label">
            <span class="msg-tooltiper">
                访问项分配：
                <div class="tooltip-msg">
                    单独分配给该用户访问项
                </div>
            </span>
        </label>
        <div class="col-xs-9">
            <div id="accesses" auth-model="access" name="accessAutoIds" data-type="arr" widget="auth-chooser"></div>
        </div>
    </div>
    <div class="form-group">
        <label class="col-xs-3 control-label">
            <span class="msg-tooltiper">
                授权项分配：
                <div class="tooltip-msg">
                    单独分配给该用户授权项
                </div>
            </span>
        </label>
        <div class="col-xs-9">
            <div id="permissions" auth-model="permission" name="permissionAutoIds" data-type="arr" widget="auth-chooser"></div>
        </div>
    </div>
    <div class="form-group">
        <label class="col-xs-3 control-label">
            <span class="msg-tooltiper">
                所有角色：
                <div class="tooltip-msg">
                    合并分配给游客的角色<br>
                    、分配给用户的角色<br>
                    得出的用户所拥有的所有角色
                </div>
            </span>
        </label>
        <div class="col-xs-9">
            <table class="table table-striped table-bordered table-hover table-condensed" style="margin-bottom:0;">
                <thead>
                    <tr>
                        <td style="width:150px;">权限来自</td>
                        <td>
                            权限
                            <input type="text" class="a-auth-search" onkeyup="all_auth_search(this)" onchange="all_auth_search(this)" style="height:22px;" placeholder="搜索">
                        </td>
                    </tr>
                </thead>
                <tbody id="allRoles"></tbody>
            </table>
        </div>
    </div>
    <div class="form-group">
        <label class="col-xs-3 control-label">
            <span class="msg-tooltiper">
                所有访问项：
                <div class="tooltip-msg">
                    合并分配给游客的角色所拥有的访问项<br>
                    、单独分配给游客的访问项<br>
                    、分配给用户的角色所拥有的访问项<br>
                    、单独分配给用户的访问项<br>
                    得出的用户所拥有的所有访问项
                </div>
            </span>
        </label>
        <div class="col-xs-9">
            <table class="table table-striped table-bordered table-hover table-condensed" style="margin-bottom:0;">
                <thead>
                    <tr>
                        <td style="width:150px;">权限来自</td>
                        <td>
                            权限
                            <input type="text" class="a-auth-search" onkeyup="all_auth_search(this)" onchange="all_auth_search(this)" style="height:22px;" placeholder="搜索">
                        </td>
                    </tr>
                </thead>
                <tbody id="allAccesses"></tbody>
            </table>
        </div>
    </div>
    <div class="form-group">
        <label class="col-xs-3 control-label">
            <span class="msg-tooltiper">
                所有授权项：
                <div class="tooltip-msg">
                    合并分配给游客的角色所拥有的授权项<br>
                    、单独分配给游客的授权项<br>
                    、分配给用户的角色所拥有的授权项<br>
                    、单独分配给用户的授权项<br>
                    得出的用户所拥有的所有授权项
                </div>
            </span>
        </label>
        <div class="col-xs-9">
            <table class="table table-striped table-bordered table-hover table-condensed" style="margin-bottom:0;">
                <thead>
                    <tr>
                        <td style="width:150px;">权限来自</td>
                        <td>
                            权限
                            <input type="text" class="a-auth-search" onkeyup="all_auth_search(this)" onchange="all_auth_search(this)" style="height:22px;" placeholder="搜索">
                        </td>
                    </tr>
                </thead>
                <tbody id="allPermissions"></tbody>
            </table>
        </div>
    </div>
    <button type="button" class="btn btn-purple btn-block" onclick="editUserAuthSave()">保存</button>
</form>
</div></div>##widget-body
</div></div>##widget-box

##用户列表
<div class="col-xs-12"><div class="widget-box">
<div class="widget-header">
    <h4 class="widget-title">用户列表</h4>
    <div class="widget-toolbar" style="line-height:28px;">
        <div class="display:inline-block" style="width:150px;display:inline-block;padding-top:3px;vertical-align:top;">
            <select id="qRole" onchange="loadUsers()" widget="select2" url="/edit/role/list.json?ignoreAuth=true" allow-clear="true" placeholder="请选择角色" style="width:100%"></select>
        </div>
        <div class="display:inline-block" style="width:150px;display:inline-block;padding-top:3px;vertical-align:top;">
            <select id="qAccess" onchange="loadUsers()" widget="select2" url="/edit/access/list.json" allow-clear="true" placeholder="请选择访问项" style="width:100%"></select>
        </div>
        <div class="display:inline-block" style="width:150px;display:inline-block;padding-top:3px;vertical-align:top;">
            <select id="qPermission" onchange="loadUsers()" widget="select2" url="/edit/permission/list.json" allow-clear="true" placeholder="请选择授权项" style="width:100%"></select>
        </div>
        <div style="width:200px;display:inline-block;">
            <div class="input-group" style="width:200px;">
                <input id="keyword" type="text" class="form-control" style="height:22px;margin-top:8px;" placeholder="请输入关键词">
                <span class="input-group-btn">
                    <button type="button" class="btn btn-purple btn-minier" onclick="loadUsers()" style="margin-top:8px;">
                        搜索<i class="ace-icon fa fa-search"></i>
                    </button>
                </span>
            </div>
        </div>
    </div>
</div>
<div class="widget-body"><div class="widget-main" style="padding-bottom:52px;">
<p class="text-info">只列出直接分配给用户的角色、访问项和授权项</p>
<table class="table table-striped table-bordered table-hover table-condensed" style="margin-bottom:0;">
    <thead>
        <tr>
            <td title="用户的ID" rowspan="2" style="min-width:100px;">ID</td>
            <td title="用户的名称" rowspan="2" style="min-width:100px;">名称</td>
            <td title="用户的配置项" colspan="2" style="min-width:300px;">配置项</td>
            <td rowspan="2" style="width:150px;" title="单独分配给用户的角色">角色</td>
            <td rowspan="2" style="width:200px;" title="单独分配给用户的访问项">访问项</td>
            <td rowspan="2" style="width:250px;" title="单独分配给用户的授权项">授权项</td>
            <td style="width:45px;" rowspan="2">操作</td>
        </tr>
        <tr>
            <td style="width:100px;">配置</td>
            <td style="width:200px;">值</td>
        </tr>
    </thead>
    <tbody id="users"></tbody>
</table>
<div id="usersPager" widget="pager" show-page-size="true" show-go="true" class="pull-right" onpage="loadUsers()"></div>
</div></div>##widget-body
</div></div>##widget-box
#parse('/footer.vm')